import numpy as np
import pygame as py

py.init()

largeur, longueur = 1360, 800
taille_cellule = 2
blanc = (255, 255, 255)
noir = (0, 0, 0)

screen = py.display.set_mode((largeur, longueur))
py.display.set_caption("Le jeu de la vie")

x = largeur // taille_cellule
y = longueur // taille_cellule

grille = np.zeros((x, y), dtype=bool)

play = False
stylo = True
gomme = False
running = True
debug = 0

clock = py.time.Clock()

voisins_anneaux = [(6.0, 4.0), (1.0, -23.0), (10.0, -21.0), (22.0, 7.0),
   (-13.0, 20.0), (13.0, -5.0), (-3.0, 5.0), (11.0, -6.0),
   (10.0, 11.0), (-4.0, 1.0), (5.0, 3.0), (-13.0, 2.0),
   (-3.0, -13.0), (-5.0, 5.0), (-6.0, 22.0), (11.0, 8.0),
   (-8.0, 11.0), (-23.0, 4.0), (2.0, -4.0), (6.0, 0.0),
   (-10.0, 10.0), (-5.0, -13.0), (-6.0, 4.0), (11.0, -10.0),
   (9.0, -21.0), (9.0, 11.0), (-5.0, 1.0), (4.0, 3.0),
   (13.0, 5.0), (-23.0, 0.0), (-14.0, 2.0), (-7.0, 22.0),
   (-9.0, -21.0), (21.0, 11.0), (7.0, 1.0), (-9.0, 11.0),
   (0.0, 13.0), (14.0, 2.0), (23.0, 4.0), (2.0, 6.0),
   (5.0, 22.0), (0.0, -5.0), (22.0, 8.0), (16.0, 17.0),
   (-4.0, 2.0), (-20.0, 12.0), (5.0, 4.0), (3.0, 3.0),
   (0.0, -23.0), (12.0, 5.0), (-13.0, 3.0), (-10.0, -21.0),
   (11.0, 9.0), (6.0, 1.0), (-10.0, 11.0), (21.0, -11.0),
   (-1.0, 13.0), (-3.0, 2.0), (7.0, 11.0), (1.0, 6.0),
   (11.0, -9.0), (10.0, 8.0), (-4.0, -2.0), (5.0, 0.0),
   (-1.0, -5.0), (-6.0, -13.0), (-13.0, -1.0), (-5.0, 2.0),
   (10.0, -10.0), (4.0, 4.0), (13.0, 6.0), (-1.0, -23.0),
   (-23.0, 1.0), (-14.0, 3.0), (6.0, -3.0), (-6.0, 1.0),
   (4.0, -14.0), (-12.0, -4.0), (-3.0, -2.0), (-8.0, -10.0),
   (-2.0, 13.0), (-10.0, -11.0), (13.0, 20.0), (15.0, -19.0),
   (8.0, 12.0), (-8.0, 22.0), (2.0, 7.0), (6.0, 11.0),
   (0.0, -4.0), (-5.0, -2.0), (4.0, 0.0), (-2.0, -5.0),
   (13.0, 2.0), (-23.0, -3.0), (-14.0, -1.0), (9.0, -10.0),
   (3.0, 4.0), (12.0, 6.0), (-2.0, -23.0), (7.0, -2.0),
   (-5.0, 12.0), (4.0, 14.0), (-14.0, -19.0), (14.0, -1.0),
   (23.0, 1.0), (-7.0, 1.0), (3.0, -14.0), (2.0, 3.0),
   (21.0, -10.0), (-9.0, -10.0), (16.0, -18.0), (12.0, 20.0),
   (14.0, -19.0), (7.0, 12.0), (-11.0, -21.0), (1.0, 7.0),
   (10.0, 9.0), (-4.0, -1.0), (-2.0, 23.0), (5.0, 1.0),
   (-13.0, 0.0), (0.0, 6.0), (10.0, -9.0), (23.0, -3.0),
   (-11.0, -7.0), (-4.0, 13.0), (-10.0, 8.0), (-18.0, -16.0),
   (3.0, 14.0), (-16.0, 17.0), (-6.0, 2.0), (-4.0, -5.0),
   (-10.0, -10.0), (5.0, -3.0), (-11.0, 7.0), (15.0, -18.0),
   (19.0, -14.0), (-15.0, -18.0), (-22.0, -6.0), (6.0, 12.0),
   (-13.0, -4.0), (9.0, 9.0), (4.0, 1.0), (-4.0, -23.0),
   (13.0, 3.0), (-3.0, 13.0), (-23.0, -2.0), (-14.0, 0.0),
   (-1.0, 6.0), (9.0, -9.0), (-6.0, -2.0), (-22.0, 8.0),
   (-12.0, -7.0), (-3.0, -5.0), (-5.0, 13.0), (-17.0, 17.0),
   (-7.0, 2.0), (2.0, 4.0), (-3.0, -23.0), (-5.0, -5.0),
   (-6.0, 12.0), (20.0, -13.0), (4.0, -3.0), (-12.0, 7.0),
   (13.0, -1.0), (2.0, -14.0), (-14.0, -4.0), (0.0, 7.0),
   (14.0, -4.0), (-2.0, 6.0), (-21.0, 9.0), (23.0, -2.0),
   (-7.0, -2.0), (-18.0, -15.0), (-16.0, 18.0), (-21.0, -9.0),
   (5.0, -2.0), (-11.0, 8.0), (-7.0, 12.0), (3.0, -3.0),
   (2.0, 14.0), (-22.0, -5.0), (-13.0, -3.0), (1.0, -14.0),
   (-20.0, -12.0), (-11.0, -10.0), (-16.0, -18.0), (5.0, 12.0),
   (-1.0, 7.0), (-6.0, -1.0), (12.0, -5.0), (19.0, 15.0),
   (-6.0, 13.0), (-12.0, 8.0), (1.0, 14.0), (-4.0, 6.0),
   (-5.0, -22.0), (-22.0, 5.0), (22.0, -6.0), (1.0, -4.0),
   (4.0, 12.0), (-4.0, -12.0), (4.0, -6.0), (-12.0, 4.0),
   (13.0, -4.0), (-3.0, 6.0), (8.0, -12.0), (6.0, -13.0),
   (-19.0, -15.0), (0.0, 4.0), (-2.0, 3.0), (-8.0, 12.0),
   (2.0, -3.0), (-5.0, -12.0), (0.0, -14.0), (20.0, 12.0),
   (3.0, -6.0), (12.0, -4.0), (7.0, -12.0), (2.0, -7.0),
   (18.0, 15.0), (-22.0, 6.0), (22.0, -5.0), (7.0, 2.0),
   (0.0, 14.0), (14.0, 3.0), (-1.0, -14.0), (12.0, -8.0),
   (-6.0, -22.0), (16.0, 18.0), (-4.0, 3.0), (-20.0, 13.0),
   (6.0, -12.0), (5.0, 5.0), (-13.0, 4.0), (17.0, -17.0),
   (1.0, -7.0), (5.0, -13.0), (11.0, 10.0), (6.0, 2.0),
   (-1.0, 14.0), (22.0, 5.0), (-2.0, -14.0), (-3.0, 3.0),
   (11.0, -8.0), (-7.0, -22.0), (20.0, 13.0), (4.0, 23.0),
   (-1.0, -4.0), (-6.0, -12.0), (15.0, 18.0), (-19.0, 14.0),
   (-15.0, 18.0), (-5.0, 3.0), (4.0, 5.0), (11.0, 6.0),
   (-23.0, 2.0), (18.0, -16.0), (2.0, -6.0), (-14.0, 4.0),
   (6.0, -2.0), (18.0, 16.0), (4.0, -13.0), (14.0, 4.0),
   (-2.0, 14.0), (12.0, -7.0), (3.0, 23.0), (-5.0, -1.0),
   (-2.0, -4.0), (-7.0, -12.0), (-4.0, 4.0), (3.0, 5.0),
   (12.0, 7.0), (21.0, 9.0), (-13.0, 5.0), (7.0, -1.0),
   (-9.0, 9.0), (1.0, -6.0), (-4.0, -14.0), (14.0, 0.0),
   (5.0, -12.0), (23.0, 2.0), (17.0, 16.0), (3.0, -13.0),
   (21.0, -9.0), (-9.0, -9.0), (16.0, -17.0), (0.0, -7.0),
   (22.0, 6.0), (11.0, -7.0), (10.0, 10.0), (-4.0, 0.0),
   (5.0, 2.0), (-6.0, -11.0), (-13.0, 1.0), (15.0, 19.0),
   (-3.0, -14.0), (-15.0, 19.0), (10.0, -8.0), (-8.0, -22.0),
   (-11.0, -6.0), (11.0, 7.0), (-8.0, 10.0), (-4.0, 14.0),
   (6.0, -1.0), (-10.0, 9.0), (-6.0, 3.0), (4.0, -12.0),
   (1.0, 4.0), (-4.0, -4.0), (-10.0, -9.0), (-1.0, -7.0),
   (11.0, 21.0), (-14.0, 19.0), (6.0, 13.0), (-12.0, -20.0),
   (9.0, 10.0), (-5.0, 0.0), (4.0, 2.0), (-2.0, -3.0),
   (13.0, 4.0), (-3.0, 14.0), (-7.0, -11.0), (-23.0, -1.0),
   (-14.0, 1.0), (14.0, 19.0), (2.0, 23.0), (-12.0, -6.0),
   (-3.0, -4.0), (-9.0, 10.0), (8.0, -22.0), (-8.0, -12.0),
   (14.0, 1.0), (23.0, 3.0), (8.0, 10.0), (2.0, 5.0),
   (0.0, -6.0), (-5.0, -4.0), (20.0, -12.0), (4.0, -2.0),
   (-2.0, -7.0), (13.0, 0.0), (2.0, -13.0), (-14.0, -3.0),
   (3.0, 2.0), (12.0, 4.0), (14.0, -3.0), (-2.0, 7.0),
   (-21.0, 10.0), (23.0, -1.0), (1.0, 23.0), (-7.0, -1.0),
   (7.0, -22.0), (1.0, 5.0), (-4.0, -3.0), (5.0, -1.0),
   (-10.0, -8.0), (-11.0, 9.0), (-1.0, -6.0), (3.0, -2.0),
   (-13.0, -2.0), (1.0, -13.0), (10.0, -11.0), (-11.0, -9.0),
   (10.0, 21.0), (-16.0, -17.0), (6.0, -4.0), (5.0, 13.0),
   (-13.0, -20.0), (-6.0, 0.0), (-12.0, -5.0), (-3.0, -3.0),
   (-8.0, -11.0), (6.0, -22.0), (5.0, -5.0), (8.0, 11.0),
   (-22.0, -8.0), (-13.0, -6.0), (-5.0, -3.0), (4.0, -1.0),
   (-2.0, -6.0), (13.0, 1.0), (-23.0, -4.0), (-14.0, -2.0),
   (-1.0, 4.0), (9.0, -11.0), (-6.0, -4.0), (9.0, 21.0),
   (-17.0, -17.0), (4.0, 13.0), (14.0, -2.0), (-21.0, 11.0),
   (23.0, 0.0), (-7.0, 0.0), (-9.0, -11.0), (4.0, -5.0),
   (-12.0, 5.0), (13.0, -3.0), (-9.0, 21.0), (8.0, -11.0),
   (0.0, 23.0), (-11.0, 10.0), (-19.0, -14.0), (4.0, -23.0),
   (0.0, 5.0), (-2.0, 4.0), (23.0, -4.0), (-11.0, -8.0),
   (-4.0, 12.0), (3.0, 13.0), (0.0, -13.0), (-18.0, 15.0),
   (-21.0, -11.0), (-4.0, -6.0), (5.0, -4.0), (-11.0, 6.0),
   (19.0, -15.0), (3.0, -5.0), (-15.0, -19.0), (-22.0, -7.0),
   (-10.0, 21.0), (-13.0, -5.0), (7.0, -11.0), (-1.0, 23.0),
   (5.0, -22.0), (3.0, -23.0), (-1.0, 5.0), (-6.0, -3.0),
   (-22.0, 7.0), (-12.0, -8.0), (-3.0, -6.0), (-17.0, -16.0),
   (-1.0, -13.0), (-17.0, 16.0), (-6.0, 11.0), (4.0, -4.0),
   (-12.0, 6.0), (13.0, -2.0), (8.0, -10.0), (6.0, -11.0),
   (8.0, 22.0), (22.0, -8.0), (13.0, -20.0), (17.0, -16.0),
   (11.0, -21.0), (-12.0, 20.0), (-2.0, 5.0), (6.0, 3.0),
   (-2.0, -13.0), (-3.0, 4.0), (13.0, -6.0), (-18.0, 16.0),
   (-21.0, -10.0), (-5.0, 22.0), (-7.0, 11.0), (3.0, -4.0),
   (2.0, 13.0), (-19.0, 15.0), (-5.0, 4.0), (4.0, 6.0),
   (-20.0, -13.0), (7.0, 22.0), (-23.0, 3.0), (18.0, -15.0),
   (2.0, -5.0), (12.0, -20.0), (-11.0, 21.0), (2.0, -23.0),
   (12.0, -6.0), (-4.0, 23.0), (19.0, 14.0), (1.0, 13.0),
   (-4.0, 5.0), (3.0, 6.0), (12.0, 8.0), (22.0, -7.0),
   (21.0, 10.0), (-13.0, 6.0), (6.0, 22.0), (7.0, 0.0),
   (1.0, -5.0), (-4.0, -13.0), (-3.0, 23.0), (17.0, 17.0)]


while running:
    screen.fill(noir)

    for event in py.event.get():
        if event.type == py.QUIT:
            running = False

        elif event.type == py.KEYDOWN and event.key == py.K_p:
            play = not play

        elif event.type == py.KEYDOWN and event.key == py.K_r:
            grille = np.random.choice([False, True],
                                      size=(x, y),
                                      p=[0.60, 0.40])

        elif event.type == py.KEYDOWN and event.key == py.K_c:
            grille = np.zeros((x, y), dtype=bool)

        elif event.type == py.KEYDOWN and event.key == py.K_s:
            gomme = False
            stylo = True

        elif event.type == py.KEYDOWN and event.key == py.K_g:
            stylo = False
            gomme = True

    if play:
        clock.tick(20)
        
        voisins = np.zeros_like(grille, dtype=int)
        for di, dj in voisins_anneaux:
            voisins += np.roll(np.roll(grille, int(di), axis=0),
                        int(dj), axis=1)

        nouvelles_grille = (voisins >= 152) & (voisins <= 212) & grille | (
            (voisins >= 121) & (voisins <= 182) & ~grille)
        grille[:, :] = nouvelles_grille

    cellule_vivante = np.argwhere(grille)
    for i in cellule_vivante:
        py.draw.rect(screen, blanc,
                     (i[0] * taille_cellule, i[1] * taille_cellule,
                      taille_cellule, taille_cellule))

    if not play:
        clock.tick(60)

    if stylo and py.mouse.get_pressed()[0]:
        mouse_pos = py.mouse.get_pos()
        i = mouse_pos[0] // taille_cellule
        j = mouse_pos[1] // taille_cellule
        if 0 <= i < x and 0 <= j < y:
            pix_stylo = [(i+1.0, j+2.0), (i+3.0, j+0.0), (i-1.0, j+4.0), 
                             (i+2.0, j+1.0), (i-3.0, j+3.0), (i-1.0, j-1.0), 
                             (i+1.0, j-3.0), (i+3.0, j+3.0), (i+2.0, j-4.0), 
                             (i-3.0, j-2.0), (i+2.0, j+4.0), (i+1.0, j+0.0), 
                             (i-1.0, j+2.0), (i+2.0, j-1.0), (i-3.0, j+1.0), 
                             (i-1.0, j-3.0), (i+1.0, j+3.0), (i+0.0, j-4.0), 
                             (i+2.0, j+2.0), (i+0.0, j+4.0), (i+4.0, j-2.0), 
                             (i-1.0, j+0.0), (i+1.0, j-2.0), (i+0.0, j-1.0), 
                             (i+2.0, j-3.0), (i+4.0, j+1.0), (i-1.0, j+3.0), 
                             (i-2.0, j-4.0), (i+2.0, j+0.0), (i+0.0, j+2.0), 
                             (i-2.0, j+4.0), (i-1.0, j-2.0), (i-2.0, j-1.0), 
                             (i+0.0, j-3.0), (i+2.0, j+3.0), (i+0.0, j+5.0), 
                             (i+4.0, j-1.0), (i+2.0, j-2.0), (i+0.0, j+0.0), 
                             (i-2.0, j+2.0), (i-5.0, j+0.0), (i+4.0, j+2.0), 
                             (i-2.0, j-3.0), (i-4.0, j-1.0), (i+0.0, j-5.0), 
                             (i+0.0, j+3.0), (i+3.0, j-2.0), (i+0.0, j-2.0), 
                             (i-2.0, j+0.0), (i-4.0, j+2.0), (i+4.0, j+0.0), 
                             (i+3.0, j+1.0), (i+0.0, j+1.0), (i-2.0, j+3.0), 
                             (i-2.0, j-2.0), (i-4.0, j+0.0), (i-3.0, j-1.0), 
                             (i+1.0, j+1.0), (i-2.0, j+1.0), (i+3.0, j-1.0), 
                             (i-3.0, j+2.0), (i+1.0, j-4.0), (i-4.0, j-2.0), 
                             (i+3.0, j+2.0), (i+1.0, j+4.0), (i+5.0, j+0.0), 
                             (i-3.0, j-3.0), (i-1.0, j+1.0), (i+1.0, j-1.0), 
                             (i+3.0, j-3.0), (i-4.0, j+1.0), (i-3.0, j+0.0), 
                             (i-1.0, j-4.0)]

            if 0 <= i < x and 0 <= j < y:
                for di, dj in pix_stylo :
                    grille[int(di), int(dj)] = True

    py.display.flip()

py.quit()


